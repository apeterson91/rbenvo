<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with Benvos • rbenvo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with Benvos">
<meta property="og:description" content="rbenvo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbenvo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Getting Started with Benvos</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with Benvos</h1>
            
      
      
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette serves to introduce the philosophy and structure of the <code>rbenvo</code> package, which impliments <code>Benvo</code> classes: Built Environment Objects. These classes make working with built environment data easier by offering a common interface to do so. We’ll illustrate some of the very basics of how to use benvo’s in this vignette as well as give some references as to how it might be used in other packages or settings.</p>
<p>We’ll begin by loading the library and the two example datasets involving subjects living near Fast Food Restaurants (FFR). One of the two datasets will be for the subject level information, <code>FFR_subjects</code>, the other will contain some measure of exposure (space/time) that describe how long and how close subjects are located near the nearby Built Environment Features (BEFs).</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rbenvo</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"FFR_distances"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"FFR_subjects"</span>)</pre></body></html></div>
<p>The subject dataframe should look familiar. This is a tidy dataset with an ID and two subject-level measures: BMI and sex.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">FFR_subjects</span>,<span class="fl">5</span>)
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;      id   BMI   sex</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     1  28.9     1</span>
<span class="co">#&gt; 2     2  33.0     1</span>
<span class="co">#&gt; 3     3  46.9     0</span>
<span class="co">#&gt; 4     4  30.2     1</span>
<span class="co">#&gt; 5     5  43.3     0</span></pre></body></html></div>
<p>The distance dataframe is a tidy “long” dataframe, containing multiple nearby BEF exposures per subject</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">FFR_distances</span>,<span class="fl">5</span>)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;      id Distance</span>
<span class="co">#&gt;   &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1    0.773</span>
<span class="co">#&gt; 2     1    0.734</span>
<span class="co">#&gt; 3     1    0.997</span>
<span class="co">#&gt; 4     1    0.470</span>
<span class="co">#&gt; 5     1    0.523</span></pre></body></html></div>
<p>In order to create a benvo we’ll pass the two dataframes to the <code><a href="../reference/benvo.html">benvo()</a></code> function, wrapping the FFR_distances data frame in a list. We’ll also pass the BEF name we want, along with the joining id name and the name of the column that contains the distance measures.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">bdf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/benvo.html">benvo</a></span>(<span class="kw">subject_data</span> <span class="kw">=</span> <span class="no">FFR_subjects</span>,
             <span class="kw">bef_data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">FFR_distances</span>),
             <span class="kw">bef_names</span> <span class="kw">=</span> <span class="st">"FFR"</span>,
             <span class="kw">joining_id</span> <span class="kw">=</span> <span class="st">"id"</span>,
             <span class="kw">distance_col</span> <span class="kw">=</span> <span class="st">"Distance"</span>)
<span class="no">bdf</span>
<span class="co">#&gt; Subject Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Observations:  1000</span>
<span class="co">#&gt; Columns:  3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; BEF Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Number of Features:  1</span>
<span class="co">#&gt; Features: </span>
<span class="co">#&gt;   Name Measures</span>
<span class="co">#&gt; 1  FFR Distance</span></pre></body></html></div>
<div id="simple-descriptives" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-descriptives" class="anchor"></a>Simple Descriptives</h2>
<p>We can see from the above a simple summary of the kind of feature that we have data on. If we call the <code>bef_summary</code> function we’ll get a more detailed understanding of the bef data available.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/bef_summary.html">bef_summary</a></span>(<span class="no">bdf</span>)
<span class="co">#&gt; # A tibble: 1 x 7</span>
<span class="co">#&gt; # Groups:   BEF [1]</span>
<span class="co">#&gt;   BEF   Distance_Time  Lower Median Upper Number Num_NA</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1 FFR   Distance      0.0278  0.504 0.975   9501      0</span></pre></body></html></div>
<p>Finally, as one last descriptive offering, we can plot a pointrange of the distances for each subject using the <code>plot_pointrange</code> function and passing the BEF label we want plotted. You’ll see that there are several observations missing, since not every subject lives near a FFR.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pointrange.html">plot_pointrange</a></span>(<span class="no">bdf</span>,<span class="st">"FFR"</span>,<span class="st">"Distance"</span>)
<span class="co">#&gt; Warning: Removed 49 rows containing missing values (geom_pointrange).</span></pre></body></html></div>
<p><img src="Introduction_files/figure-html/plot-1.png" width="700"></p>
</div>
</div>
<div id="other-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#other-packages" class="anchor"></a>Other packages</h1>
<p>While the above descriptive statistics are nice, the real power of using <code>benvos</code> is that they offer functions like <code>joinvo</code> to easily join the subject and bef data frames, which can be useful in setting up the data for models in other packages. Below we’ll use the <code>joinvo</code> function, passing the benvo, bef character label, and <code>TRUE</code> to the tibble argument, denoting that we want a tibble object returned from the function.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/joinvo.html">joinvo</a></span>(<span class="no">bdf</span>,<span class="st">"FFR"</span>,<span class="kw">tibble</span><span class="kw">=</span><span class="no">T</span>)
<span class="co">#&gt; # A tibble: 9,550 x 4</span>
<span class="co">#&gt;       ID Distance   BMI   sex</span>
<span class="co">#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     1    0.773  28.9     1</span>
<span class="co">#&gt;  2     1    0.734  28.9     1</span>
<span class="co">#&gt;  3     1    0.997  28.9     1</span>
<span class="co">#&gt;  4     1    0.470  28.9     1</span>
<span class="co">#&gt;  5     1    0.523  28.9     1</span>
<span class="co">#&gt;  6     2    0.369  33.0     1</span>
<span class="co">#&gt;  7     2    0.533  33.0     1</span>
<span class="co">#&gt;  8     2    0.779  33.0     1</span>
<span class="co">#&gt;  9     2    0.723  33.0     1</span>
<span class="co">#&gt; 10     2    0.375  33.0     1</span>
<span class="co">#&gt; # … with 9,540 more rows</span></pre></body></html></div>
<p>Similarly, it is often the case - in my work at least - that some sort of model involving both the built environment data and the subject level data is needed. This means that information is incorporated at the subject level. This could manifest in, for example, the construction of a subject design matrix. Below I’ll demonstrate how this works in a cross sectional as well as longitudinal framework, whilst highlighting how some of the previous functions take advantage of the longitudinal structure.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="../reference/subject_design.html">subject_design</a></span>(<span class="no">bdf</span>,<span class="no">BMI</span> ~ <span class="no">sex</span>))
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ y          : Named num [1:1000] 28.9 33 46.9 30.2 43.3 ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:1000] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;  $ X          : num [1:1000, 1:2] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:1000] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:2] "(Intercept)" "sex"</span>
<span class="co">#&gt;   ..- attr(*, "assign")= int [1:2] 0 1</span>
<span class="co">#&gt;  $ model_frame:'data.frame': 1000 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ BMI: num [1:1000] 28.9 33 46.9 30.2 43.3 ...</span>
<span class="co">#&gt;   ..$ sex: int [1:1000] 1 1 0 1 0 1 1 0 0 1 ...</span>
<span class="co">#&gt;   ..- attr(*, "terms")=Classes 'terms', 'formula'  language BMI ~ sex</span>
<span class="co">#&gt;   .. .. ..- attr(*, "variables")= language list(BMI, sex)</span>
<span class="co">#&gt;   .. .. ..- attr(*, "factors")= int [1:2, 1] 0 1</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : chr [1:2] "BMI" "sex"</span>
<span class="co">#&gt;   .. .. .. .. ..$ : chr "sex"</span>
<span class="co">#&gt;   .. .. ..- attr(*, "term.labels")= chr "sex"</span>
<span class="co">#&gt;   .. .. ..- attr(*, "order")= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, "intercept")= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, "response")= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; </span>
<span class="co">#&gt;   .. .. ..- attr(*, "predvars")= language list(BMI, sex)</span>
<span class="co">#&gt;   .. .. ..- attr(*, "dataClasses")= Named chr [1:2] "numeric" "numeric"</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "names")= chr [1:2] "BMI" "sex"</span></pre></body></html></div>
<div id="longitudinal-example" class="section level3">
<h3 class="hasAnchor">
<a href="#longitudinal-example" class="anchor"></a>Longitudinal Example</h3>
<p>For our longitudinal example we’ll look at a dataset that imagines a hypothetical set of grocery or “Healthy Food Stores”(HFS) near subjects. Subjects or grocery stores may move over time so this will be reflected in our data. Below we’ll repeat the similar descriptives from above, highlighting the differences in a longitudinal <code>benvo</code>.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"longitudinal_HFS"</span>)
<span class="no">longitudinal_HFS</span>
<span class="co">#&gt; Subject Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Observations:  596</span>
<span class="co">#&gt; Columns:  6</span>
<span class="co">#&gt; Num Subjects:  300</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; BEF Data:</span>
<span class="co">#&gt; ---------------------------:</span>
<span class="co">#&gt; Number of Features:  1</span>
<span class="co">#&gt; Features: </span>
<span class="co">#&gt;   Name      Measures</span>
<span class="co">#&gt; 1  HFS Distance-Time</span></pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/bef_summary.html">bef_summary</a></span>(<span class="no">longitudinal_HFS</span>)
<span class="co">#&gt; # A tibble: 10 x 8</span>
<span class="co">#&gt; # Groups:   BEF, Distance_Time [2]</span>
<span class="co">#&gt;    BEF   Distance_Time Measurement  Lower Median Upper Number Num_NA</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;               &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;</span>
<span class="co">#&gt;  1 HFS   Distance                1 0.0275  0.486 0.971   2845      0</span>
<span class="co">#&gt;  2 HFS   Distance                2 0.0278  0.492 0.973   1772      0</span>
<span class="co">#&gt;  3 HFS   Distance                3 0.0240  0.503 0.959    743      0</span>
<span class="co">#&gt;  4 HFS   Distance                4 0.0233  0.438 0.988    272      0</span>
<span class="co">#&gt;  5 HFS   Distance                5 0.0390  0.478 0.962     53      0</span>
<span class="co">#&gt;  6 HFS   Time                    1 0.131   2.55  4.87    2845      0</span>
<span class="co">#&gt;  7 HFS   Time                    2 0.156   2.47  4.87    1772      0</span>
<span class="co">#&gt;  8 HFS   Time                    3 0.130   2.64  4.88     743      0</span>
<span class="co">#&gt;  9 HFS   Time                    4 0.115   2.71  4.91     272      0</span>
<span class="co">#&gt; 10 HFS   Time                    5 0.201   2.57  4.65      53      0</span></pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pointrange.html">plot_pointrange</a></span>(<span class="no">longitudinal_HFS</span>,<span class="st">"HFS"</span>,<span class="st">"Distance"</span>)
<span class="co">#&gt; Warning: Removed 24 rows containing missing values (geom_pointrange).</span></pre></body></html></div>
<p><img src="Introduction_files/figure-html/long_plot-1.png" width="700"></p>
<p>Analogous to <code>subject_design</code> there is also the <code>longitudinal_design</code> function which effectively allows for <code>lme4</code> style formulas to be used, incorporating subject or group level effects from the <code>subject_data</code> in the <code>benvo</code> and returning a <code>glmod</code> object along with the corresponding <code>X</code> and <code>y</code> design matrix and outcome vector, respectively.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="../reference/longitudinal_design.html">longitudinal_design</a></span>(<span class="no">longitudinal_HFS</span>,<span class="no">BMI</span> ~ <span class="no">sex</span> + (<span class="fl">1</span><span class="kw">|</span><span class="no">ID</span>)),<span class="kw">max.level</span><span class="kw">=</span><span class="fl">1</span>)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ y    : num [1:596] 28.1 29.4 29.7 30.6 28 ...</span>
<span class="co">#&gt;  $ X    : num [1:596, 1:2] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   ..- attr(*, "assign")= int [1:2] 0 1</span>
<span class="co">#&gt;   ..- attr(*, "msgScaleX")= chr(0) </span>
<span class="co">#&gt;  $ glmod:List of 6</span></pre></body></html></div>
</div>
<div id="further-information" class="section level2">
<h2 class="hasAnchor">
<a href="#further-information" class="anchor"></a>Further Information</h2>
<p>This completes this preliminary introduction to the <code>rbenvo</code> package. For current uses please see the <a href="https://apeterson91.github.io/rsstap/"><code>rsstap</code></a> or <a href="https://apeterson91.github.io/rstapDP/"><code>rstapDP</code></a> packages. I’ve found that having these data structures greatly simplifies my code and allows for data to be organized more easily. If you’re working with similar data, I hope you find the same!</p>
<p>I’m hoping to add more functions and classes soon that will make it easy to construct benvos from latitude-longitude coordinates or <code>sf</code> BEF data structures. Stay tuned for these updates.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adam Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
