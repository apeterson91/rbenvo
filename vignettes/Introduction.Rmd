---
title: "Getting Started with Benvos"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with Benvos}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Introduction

This vignette serves to introduce the philosophy and structure of the `rbenvo` package, which impliments `Benvo` classes: Built Environment Objects. These classes make working with built environment data easier by offering a common interface to do so. We'll illustrate some of the very basics of how to use benvo's in this vignette as well
as give some references as to how it might be used in other packages or settings.

We'll begin by loading the library and the two example datasets involving subjects living near Fast Food Restaurants (FFR). One of the two datasets will be for the subject level information, `FFR_subjects`, the other will 
contain some measure of exposure (space/time) that describe how long and how close subjects are located near the nearby Built Environment Features (BEFs).

```{r setup,message=F,results=F}
library(rbenvo)
data("FFR_distances")
data("FFR_subjects")
```


The subject dataframe should look familiar. This is a tidy dataset with an ID and two subject-level measures: BMI and sex.

```{r subjdf}
head(FFR_subjects,5)
```

The distance dataframe is a tidy "long" dataframe, containing multiple nearby BEF exposures per subject
```{r befdf}
head(FFR_distances,5)
```

In order to create a benvo we'll pass the two dataframes to the `benvo()` function, wrapping the FFR_distances data frame in a list. We'll also pass the BEF name we want, along with the joining id name and the name of the column that contains the distance measures.

```{r mkbenvo}
bdf <- benvo(subject_data = FFR_subjects,
             bef_data = list(FFR_distances),
             bef_names = "FFR",
             joining_id = "id",
             distance_col = "Distance")
bdf
```
## Simple Descriptives

We can see from the above a simple summary of the kind of feature that we have data on. If we call the `bef_summary` function we'll get a more detailed understanding of the bef data available.

```{r summary}
bef_summary(bdf)
```

Finally, as one last descriptive offering, we can plot a pointrange of the distances for each subject using the 
`plot_pointrange` function and passing the BEF label we want plotted. You'll see that there are several observations missing, since not every subject lives near a FFR.


```{r plot}
plot_pointrange(bdf,"FFR","Distance")
```


# Other packages

While the above descriptive statistics are nice, the real power of using `benvos` is that they offer 
functions like `joinvo` to easily join the subject and bef data frames, which can be useful in setting up the data for models in other packages. Below we'll use the `joinvo` function, passing the benvo, bef character label, and `TRUE` to the tibble argument, denoting that we want a tibble object returned from the function.

```{r}
joinvo(bdf,"FFR",tibble=T)
```

Similarly, it is often the case - in my work at least - that some sort of model involving both the built environment data and the subject level data is needed. This means that information is incorporated at the subject level. This could manifest in, for example, the construction of 
a subject design matrix. Below I'll demonstrate how this works in a cross sectional as well as longitudinal framework, whilst highlighting how some of the previous functions take advantage
of the longitudinal structure.

```{r subjectdesign_example}
str(subject_design(bdf,BMI ~ sex))
```

### Longitudinal Example

For our longitudinal example we'll look at a dataset that imagines a hypothetical set of grocery or "Healthy Food Stores"(HFS)  near subjects. Subjects or grocery stores may move over
time so this will be reflected in our data.
```{r longitudinal_example}
data("longitudinal_HFS")
longitudinal_HFS
```

```{r longitudinal_summary}
bef_summary(longitudinal_HFS)
```


```{r long_plot}
plot_pointrange(longitudinal_HFS,"HFS","Distance")
```



```{r longitudinal_design_ex}
str(longitudinal_design(longitudinal_HFS,BMI ~ sex + (1|ID)),max.level=1)
```


